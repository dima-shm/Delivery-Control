@model DelControlWeb.ViewModels.Order.CreateViewModel
@{
    ViewBag.Title = "Добавить новый заказ";
}

<p>
    @Html.ActionLink("Назад к списку", "Index")
</p>
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.Label("Имя заказчика", htmlAttributes: new { @class = "control-label col-md-5" })
            <div class="col-md-7">
                @Html.DropDownList("CustomerId", new SelectList(ViewBag.Customers, "Id", "Name"), htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.CustomerId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("Адрес доставик", htmlAttributes: new { @class = "control-label col-md-5" })
            <div class="col-md-7">
                @Html.DropDownList("DeliveryId", new SelectList(ViewBag.Delivery, "Id", "Address"), htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.DeliveryId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("Товары в заказе", htmlAttributes: new { @class = "control-label col-md-5" })
            <div class="col-md-3">
                @Html.DropDownList("products", new SelectList(ViewBag.Products, "Id", "Name"), htmlAttributes: new { @class = "form-control" })
            </div>
            <div class="col-md-1">
                <button type="button" id="add_product_btn" class="btn btn-primary glyphicon glyphicon-plus-sign" />
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-5 col-md-7">
                <table id="table_products" name="ProductIds">
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-5 col-md-5">
                <input type="submit" value="Добавить" class="btn btn-block btn-primary" />
            </div>
        </div>
    </div>
}

@section scripts{
    <script type="text/javascript">
        $(function () {
            $('#add_product_btn').bind('click', function () {
                var productName = $('#products :selected').text();
                var productId = $('#products :selected').val();
                var markup = "<tr><input id='ProductIds' name='ProductIds' type='hidden' value='" + productId + "'><td id='" + productId + "' class='col-md-2'>" + productName + "</td><td class='col-md-3'><button id='remove_product_btn' type='button' class='btn btn-danger glyphicon glyphicon-remove-sign' /></td></tr>";
                $("table tbody").append(markup);
            });
            $('#table_products').on('click', '#remove_product_btn', DeleteRow);
            function DeleteRow() {
                var parentID = $(this).parent().parent().attr("id");
                $(this).parent().parent().remove();
                delete (Tables[parentID]);
                Tables.length--;
            }
        });
    </script>
}