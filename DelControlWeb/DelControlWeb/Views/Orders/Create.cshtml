@model DelControlWeb.ViewModels.Order.CreateViewModel
@{
    ViewBag.Title = "Добавить новый заказ";
}

<p>
    @Html.ActionLink("Назад к списку", "Index")
</p>
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="col-md-5">
            <div class="form-group">
                @Html.Label("Имя заказчика", htmlAttributes: new { @class = "control-label col-md-5" })
                <div class="col-md-7">
                    @Html.EditorFor(model => model.CustomerName, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CustomerName, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.Label("Адрес доставик", htmlAttributes: new { @class = "control-label col-md-5" })
                <div class="col-md-7">
                    @Html.EditorFor(model => model.DeliveryAddress, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.DeliveryAddress, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.Label("Дата доставки", htmlAttributes: new { @class = "control-label col-md-5" })
                <div class="col-md-7">
                    @Html.EditorFor(model => model.DeliveryDate, new { htmlAttributes = new { @class = "form-control", min = DateTime.Now.ToString("yyyy-MM-dd") } })
                    @Html.ValidationMessageFor(model => model.DeliveryDate, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.Label("Время доставки", htmlAttributes: new { @class = "control-label col-md-5" })
                <div class="col-md-7">
                    @Html.EditorFor(model => model.DeliveryTime, new { htmlAttributes = new { @class = "form-control", max = DateTime.Now.ToString("yyyy-MM-dd") } })
                    @Html.ValidationMessageFor(model => model.DeliveryTime, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.Label("Комментарий к заказу", htmlAttributes: new { @class = "control-label col-md-5" })
                <div class="col-md-7">
                    @Html.EditorFor(model => model.Comment, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Comment, "", new { @class = "text-danger" })
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="form-group">
                @Html.Label("Товары в заказе", htmlAttributes: new { @class = "control-label col-md-5" })
                <table class="table table-striped table-hover" id="table_products">
                    <thead>
                        <tr>
                            <th>Имя товара</th>
                            <th>Описание</th>
                            <th>Цена</th>
                            <td></td>
                        </tr>
                        <tr>
                            <td><input type="text" id='product_name' name='OrderProducts[0].ProductName' class="form-control"></td>
                            <td><input type="text" id='product_description' name='OrderProducts[0].Descriotion' class="form-control"></td>
                            <td><input type="text" id='product_price' name='OrderProducts[0].Price' class="form-control"></td>
                            <td><button type="button" id="add_product_btn" class="btn btn-primary glyphicon glyphicon-plus-sign" /></td>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-5 col-md-5">
                <input type="submit" value="Добавить" class="btn btn-block btn-primary" />
            </div>
        </div>
    </div>
}

@section scripts{
    <script type="text/javascript">
        $(function () {
            var i = 1;
            $('#add_product_btn').click(function () {
                var productName = $('#product_name').val();
                var productDesc = $('#product_description').val();
                var productPrice = $('#product_price').val();
                var markup = "<tr id='" + i + "'>" +
                    "<td><input name='OrderProducts[" + i + "].ProductName' type='hidden' value='" + productName + "'>" + productName + "</td>" +
                    "<td><input name='OrderProducts[" + i + "].Descriotion' type='hidden' value='" + productDesc + "'>" + productDesc + "</td>" +
                    "<td><input name='OrderProducts[" + i + "].Price' type='hidden' value='" + productPrice + "'>" + productPrice + "</td>" +
                    "<td><button id='remove_product_btn' type='button' class='btn btn-danger glyphicon glyphicon-remove-sign' /></td>" +
                    "</tr>";
                i++;
                $("table tbody").append(markup);
                $('#product_name').val("");
                $('#product_description').val("");
                $('#product_price').val("");
            });
            $('#table_products').on('click', '#remove_product_btn', DeleteRow);
            function DeleteRow() {
                var parentID = $(this).parent().parent().attr("id");
                $(this).parent().parent().remove();
                delete (Tables[parentID]);
                Tables.length--;
            }
        });
    </script>
}